<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.boychai.xyz","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"base16/google-dark","dark":"base16/google-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="概述 Ansible 是一个极其简单的 IT 自动化平台，可让您的应用程序和系统更易于部署和维护。从代码部署到网络配置再到云管理，使用一种接近简单英语的语言，使用 SSH 实现一切自动化，无需在远程系统上安装代理。  GitHub: github.com&#x2F;ansible&#x2F;ansible Ansible官网: www.ansible.com  安装配置和使用 安装 配置好扩展源(epel-relea">
<meta property="og:type" content="article">
<meta property="og:title" content="Ansible-自动化运维工具">
<meta property="og:url" content="https://blog.boychai.xyz/2022/03/05/Ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/index.html">
<meta property="og:site_name" content="BoyChai&#39;s Blog">
<meta property="og:description" content="概述 Ansible 是一个极其简单的 IT 自动化平台，可让您的应用程序和系统更易于部署和维护。从代码部署到网络配置再到云管理，使用一种接近简单英语的语言，使用 SSH 实现一切自动化，无需在远程系统上安装代理。  GitHub: github.com&#x2F;ansible&#x2F;ansible Ansible官网: www.ansible.com  安装配置和使用 安装 配置好扩展源(epel-relea">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_playbook_1.png">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_playbook_2.png">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_playbook_3.png">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_playbook_4.png">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_playbook_5.png">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_roles_1.png">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_roles_2.png">
<meta property="og:image" content="https://image.boychai.xyz/article/ansible_vault_1.png">
<meta property="article:published_time" content="2022-03-05T10:02:00.000Z">
<meta property="article:modified_time" content="2025-07-17T05:40:18.597Z">
<meta property="article:author" content="BoyChai">
<meta property="article:tag" content="开源工具">
<meta property="article:tag" content="Ansible">
<meta property="article:tag" content="自动化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.boychai.xyz/article/ansible_playbook_1.png">


<link rel="canonical" href="https://blog.boychai.xyz/2022/03/05/Ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.boychai.xyz/2022/03/05/Ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/","path":"2022/03/05/Ansible-自动化运维工具/","title":"Ansible-自动化运维工具"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Ansible-自动化运维工具 | BoyChai's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="dns-prefetch" href="waline-server-ten-phi.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="BoyChai's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband">
  <a target="_blank" rel="noopener" href="https://github.com/boychai" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">BoyChai's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-开往"><a href="https://www.travellings.cn/go.html" rel="section" target="_blank"><i class="fa fa-car fa-fw"></i>开往</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">安装配置和使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">2.3.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="nav-number">3.</span> <span class="nav-text">常用模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3"><span class="nav-number">3.2.</span> <span class="nav-text">模块使用文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ping%E6%A8%A1%E5%9D%97"><span class="nav-number">3.3.</span> <span class="nav-text">ping模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell-command%E6%A8%A1%E5%9D%97"><span class="nav-number">3.4.</span> <span class="nav-text">shell&#x2F;command模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Script%E6%A8%A1%E5%9D%97"><span class="nav-number">3.5.</span> <span class="nav-text">Script模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#user%E6%A8%A1%E5%9D%97"><span class="nav-number">3.6.</span> <span class="nav-text">user模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yum-repository%E6%A8%A1%E5%9D%97"><span class="nav-number">3.7.</span> <span class="nav-text">yum_repository模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yum%E6%A8%A1%E5%9D%97"><span class="nav-number">3.8.</span> <span class="nav-text">yum模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#copy%E6%A8%A1%E5%9D%97"><span class="nav-number">3.9.</span> <span class="nav-text">copy模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#service%E6%A8%A1%E5%9D%97"><span class="nav-number">3.10.</span> <span class="nav-text">service模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#set-up%E6%A8%A1%E5%9D%97"><span class="nav-number">3.11.</span> <span class="nav-text">set-up模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#firewalld%E6%A8%A1%E5%9D%97"><span class="nav-number">3.12.</span> <span class="nav-text">firewalld模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#template%E6%A8%A1%E5%9D%97"><span class="nav-number">3.13.</span> <span class="nav-text">template模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#debug%E6%A8%A1%E5%9D%97"><span class="nav-number">3.14.</span> <span class="nav-text">debug模块</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Playbook%E5%89%A7%E6%9C%AC"><span class="nav-number">4.</span> <span class="nav-text">Playbook剧本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8palybook"><span class="nav-number">4.1.</span> <span class="nav-text">使用palybook</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F"><span class="nav-number">4.2.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AD%94%E6%B3%95%E5%8F%98%E9%87%8F"><span class="nav-number">4.3.</span> <span class="nav-text">魔法变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Facts%E5%8F%98%E9%87%8F"><span class="nav-number">4.4.</span> <span class="nav-text">Facts变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#When%E5%88%A4%E6%96%AD"><span class="nav-number">4.5.</span> <span class="nav-text">When判断</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Loop%E5%BE%AA%E7%8E%AF"><span class="nav-number">4.6.</span> <span class="nav-text">Loop循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Block%E5%9D%97"><span class="nav-number">4.7.</span> <span class="nav-text">Block块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#register%E5%91%BD%E4%BB%A4%E8%BF%94%E5%9B%9E"><span class="nav-number">4.8.</span> <span class="nav-text">register命令返回</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Roles%E8%A7%92%E8%89%B2"><span class="nav-number">5.</span> <span class="nav-text">Roles角色</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">5.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Roles%E5%AD%90%E7%9B%AE%E5%BD%95"><span class="nav-number">5.2.</span> <span class="nav-text">Roles子目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Galaxy"><span class="nav-number">5.3.</span> <span class="nav-text">Galaxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#J2"><span class="nav-number">5.4.</span> <span class="nav-text">J2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%A6%E8%A7%A3"><span class="nav-number">5.4.1.</span> <span class="nav-text">详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E6%88%90"><span class="nav-number">5.4.2.</span> <span class="nav-text">构成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E6%B3%95"><span class="nav-number">5.4.3.</span> <span class="nav-text">写法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8%E8%A7%92%E8%89%B2"><span class="nav-number">5.5.</span> <span class="nav-text">创建和使用角色</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Vault%E5%8A%A0%E5%AF%86"><span class="nav-number">6.</span> <span class="nav-text">Vault加密</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF"><span class="nav-number">6.1.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="nav-number">6.2.</span> <span class="nav-text">参数详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.3.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">7.</span> <span class="nav-text">其他</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#hosts%E4%B8%BB%E6%9C%BA%E6%96%87%E4%BB%B6%E5%86%99%E6%B3%95"><span class="nav-number">7.1.</span> <span class="nav-text">hosts主机文件写法</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="BoyChai"
      src="https://avatars.githubusercontent.com/u/88495409?s=96&v=4">
  <p class="site-author-name" itemprop="name">BoyChai</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/BoyChai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;BoyChai" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:admin@boychai.xyz" title="E-Mail → mailto:admin@boychai.xyz" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/277637284" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;277637284" rel="noopener me" target="_blank"><i class="fab fa-bilibili fa-fw"></i>Bilibili</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.boychai.xyz/2022/03/05/Ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/88495409?s=96&v=4">
      <meta itemprop="name" content="BoyChai">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BoyChai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Ansible-自动化运维工具 | BoyChai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Ansible-自动化运维工具
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-05 10:02:00" itemprop="dateCreated datePublished" datetime="2022-03-05T10:02:00+00:00">2022-03-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">工具相关</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2022/03/05/Ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2022/03/05/Ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>17 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>Ansible 是一个极其简单的 IT 自动化平台，可让您的应用程序和系统更易于部署和维护。从代码部署到网络配置再到云管理，使用一种接近简单英语的语言，使用 SSH 实现一切自动化，无需在远程系统上安装代理。</p>
<p><strong>GitHub:</strong> <a target="_blank" rel="noopener" href="http://github.com/ansible/ansible">github.com&#x2F;ansible&#x2F;ansible</a><br><strong>Ansible官网:</strong> <a target="_blank" rel="noopener" href="http://www.ansible.com/">www.ansible.com</a></p>
<h1 id="安装配置和使用"><a href="#安装配置和使用" class="headerlink" title="安装配置和使用"></a>安装配置和使用</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>配置好扩展源(epel-release)就可以使用yum安装了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ansible</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Ansible的stockings are not only beautiful but also practical. They are made from a high-quality material that is both comfortable and durable. The stockings are available in a variety of colors and patterns, so you can find the perfect pair to match your style.</p>
<p>Ansible的配置文件存在优先级问题,默认状态下会使用<code>/etc/ansible/ansible.cfg</code>具体优先级关系如下：</p>
<p>最高优先级是执行命令的当前目录下</p>
<ul>
<li><code>./ansible.cfg</code></li>
</ul>
<p>如果当前目录下找不到配置文件就会查找执行用户的家目录寻找</p>
<ul>
<li><code>~/.ansible.cfg</code></li>
</ul>
<p>以上位置就会选择默认的配置文件</p>
<ul>
<li><code>/etc/ansible/ansible.cfg</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# <span class="built_in">cp</span> /etc/ansible/ansible.cfg ~/.ansible.cfg</span><br><span class="line">[root@host ~]# vim ./anaconda-ks.cfg</span><br><span class="line">//找到defaults段，这段不取消注释则采用默认配置，下面的参数可以自己配置</span><br><span class="line">inventory    /etc/ansible/hosts  //主机清单文件路径</span><br><span class="line">roles_path   /etc/ansible/roles  //role存放目录</span><br><span class="line">remote_user  root                //执行命令的用户</span><br><span class="line">//找到privilege_escalation段，这一块主要是和耍权相关这里取不取消注释无所谓可以按照自己环境来修改</span><br><span class="line">become=True                      //是否开启提权</span><br><span class="line">become_method=<span class="built_in">sudo</span>               //定义执行方式</span><br><span class="line">become_user=root                 //定义执行用户</span><br><span class="line">become_ask_pass=False            //定义提示密码</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><strong>配置hosts主机文件</strong></p>
<p>使用的时候需要定义host主机文件，里面是存放被控主机的ip地址，建议必须是使用可以ssh免密登录的主机。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# <span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; /etc/ansible/hosts           //清除hosts主机文件</span><br><span class="line">[root@host ~]# vim /etc/ansible/hosts                //编辑hosts主机文件，并向里面添加主机</span><br><span class="line">[host]</span><br><span class="line">192.168.1.112</span><br><span class="line">[host2]</span><br><span class="line">192.168.1.113</span><br></pre></td></tr></table></figure>

<p>hosts主机还有多种写法，具体请看本文的其他栏<br>ps:写好主机文件之后的操作需要建立在ssh免密之后才可以执行，具体方法可以看文章的其他栏，有问题欢迎在评论区提问</p>
<p>简单使用方法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# ansible all --list   //列出所有主机</span><br><span class="line">  hosts (2):</span><br><span class="line">    192.168.1.112</span><br><span class="line">    192.168.1.113</span><br><span class="line">[root@host ~]# ansible all -m ping     //验证全部主机的连通性</span><br><span class="line">192.168.1.112 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">192.168.1.113 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h1><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# ansible 组/主机 -m 模块 //使用-m参数来指定相应模块</span><br></pre></td></tr></table></figure>

<h2 id="模块使用文档"><a href="#模块使用文档" class="headerlink" title="模块使用文档"></a>模块使用文档</h2><p>ansible为每个模块都提供了文档<br>使用命令<code>ansible-doc -l</code> 可以列出全部的ansible模块<br>使用命令<code>ansible-doc &#123;模块名称&#125;</code>   可以查看对应模块的帮助文档</p>
<h2 id="ping模块"><a href="#ping模块" class="headerlink" title="ping模块"></a>ping模块</h2><p>测试主机的连通性<br>直接使命令:<code>ansible 主机/组 -m ping</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# ansible all -m ping</span><br><span class="line">192.168.1.113 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">192.168.1.112 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回pong则证明连通性没问题</p>
<h2 id="shell-command模块"><a href="#shell-command模块" class="headerlink" title="shell&#x2F;command模块"></a>shell&#x2F;command模块</h2><p>执行命令<br>直接使命令:<code>ansible 主机/组 -m shell/command -a &quot;执行的命令&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# ansible all -m shell -a <span class="string">&quot;ping baidu.com -c 1&quot;</span></span><br><span class="line">192.168.1.113 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">PING baidu.com (220.181.38.148) 56(84) bytes of data.</span><br><span class="line">64 bytes from 220.181.38.148 (220.181.38.148): icmp_seq=1 ttl=50 <span class="keyword">time</span>=18.5 ms</span><br><span class="line"></span><br><span class="line">--- baidu.com ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, <span class="keyword">time</span> 0ms</span><br><span class="line">rtt min/avg/max/mdev = 18.489/18.489/18.489/0.000 ms</span><br><span class="line">192.168.1.112 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">PING baidu.com (220.181.38.148) 56(84) bytes of data.</span><br><span class="line">64 bytes from 220.181.38.148 (220.181.38.148): icmp_seq=1 ttl=50 <span class="keyword">time</span>=17.6 ms</span><br><span class="line"></span><br><span class="line">--- baidu.com ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, <span class="keyword">time</span> 0ms</span><br><span class="line">rtt min/avg/max/mdev = 17.597/17.597/17.597/0.000 ms</span><br></pre></td></tr></table></figure>

<p><strong>Shell和Command都是执行命令 但是两者有一定的区别</strong><br><strong>Command</strong><br>该模块命令里如果有一下字符部分执行不成功 “&lt;” “&gt;” “|” “&amp;””;”<br><strong>Shell</strong><br>用法基本和command一样 不过时通过&#x2F;bin&#x2F;sh进行执行,所以shell模块可以执行任何命令,就像在本机执行命令一样,但是这样有潜在的shell注入的风险<br>两个模块都要避免使用,你应该优先考虑ansible的模块<br>其他参数可以查看<code>ansible-doc</code>来详细学习</p>
<h2 id="Script模块"><a href="#Script模块" class="headerlink" title="Script模块"></a>Script模块</h2><p>主要用于执行管理主机上的脚本 原理就是将shell复制到远程主机,再远程主机上执行<br>使用命令:<code>ansible 主机/组 -m script -a &quot;控制端的脚本&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# <span class="built_in">echo</span> <span class="string">&quot;echo hello,world&quot;</span> &gt; 1.sh </span><br><span class="line">[root@host ~]# ansible all -m script -a <span class="string">&#x27;./1.sh&#x27;</span></span><br><span class="line">192.168.1.112 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;Shared connection to 192.168.1.112 closed.\r\n&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stderr_lines&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Shared connection to 192.168.1.112 closed.&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;hello,world\r\n&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stdout_lines&quot;</span>: [ </span><br><span class="line">        <span class="string">&quot;hello,world&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.1.113 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;Shared connection to 192.168.1.113 closed.\r\n&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stderr_lines&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Shared connection to 192.168.1.113 closed.&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;hello,world\r\n&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stdout_lines&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;hello,world&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Stdout_lines参数就是实际机器返回的值<br>其他参数可以查看<code>ansible-doc</code>来详细学习</p>
<h2 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a>user模块</h2><p>主要用于管理用户<br>使用命令：<code>ansible 主机/组 -m user -a &#39;参数&#39;</code><br>添加一个用户<code>ansible 主机/组 -m user -a ‘name=admin state=present’</code><br>state可以理解为动作 增加删除修改 默认state就是present</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# ansible all -m user -a <span class="string">&quot;name=admin state=present&quot;</span></span><br><span class="line">192.168.0.103 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;create_home&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 1000,</span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>,</span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>,</span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 1000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用命令：<code>ansible 主机/组 -m user -a ‘name=admin state=absent’</code> 可以删除admin用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# ansible all -m user -a <span class="string">&quot;name=admin state=absent&quot;</span></span><br><span class="line">192.168.0.103 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;force&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;remove&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;absent&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他可以查看<code>ansible-doc</code>来详细学习</p>
<h2 id="yum-repository模块"><a href="#yum-repository模块" class="headerlink" title="yum_repository模块"></a>yum_repository模块</h2><p>主要用于批量更新yum源<br><code>ansible 主机/组 -m yum_repository -a &#39;参数&#39;</code><br><code>ansible 主机/组 -m yum_repository -a &#39;name=&quot;CentOS&quot; description=&quot;CentOS&quot; baseurl=&quot;file:///mntcdrom&quot; enabled=yes gpgcheck=no&#39;</code></p>
<ul>
<li><strong>name</strong> 设置了文件名和文件中[]的内容</li>
<li><strong>description</strong> 设置了文件中name的内容</li>
<li><strong>baseurl</strong> 设置了文件中源的地址</li>
<li><strong>enabled</strong> 设置了enable参数</li>
<li><strong>gpgcheck</strong> 设置了是否需要密钥来验证包</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@host ~]# ansible all -m yum_repository -a <span class="string">&#x27;name=&quot;CentOS&quot; description=&quot;CentOS&quot; baseurl=&quot;file:///mntcdrom&quot; enabled=yes gpgcheck=no&#x27;</span></span><br><span class="line">192.168.0.103 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/libexec/platform-python&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;repo&quot;</span>: <span class="string">&quot;CentOS&quot;</span>,</span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">[root@host ~]# ssh root@192.168.0.103</span><br><span class="line">Last login: Sun Apr  3 12:20:11 2022 from 192.168.0.102</span><br><span class="line">[root@localhost ~]# <span class="built_in">cat</span> /etc/yum.repos.d/CentOS.repo</span><br><span class="line">[CentOS]</span><br><span class="line">baseurl = file:///mntcdrom</span><br><span class="line">enabled = 1</span><br><span class="line">gpgcheck = 0</span><br><span class="line">name = CentOS</span><br></pre></td></tr></table></figure>

<p>他会在对控制主机里生成相应的yum源配置文件<br>还有很多参数可以用<code>ansible-doc yum_repository</code>来查看文档</p>
<h2 id="yum模块"><a href="#yum模块" class="headerlink" title="yum模块"></a>yum模块</h2><p>主要是用来操作yum的<br><code>ansible 主机/组 -m yum -a ‘参数’</code><br><strong>参数详解</strong></p>
<ul>
<li><strong>Name</strong> 包名</li>
<li><strong>State</strong> 选择是安装还是删除还是更新(present和installed是安装 latest是更新 removed和absent是移除)</li>
</ul>
<p>这是基本使用 还有很多参数详情请使用<code>ansible-doc yum</code>查看</p>
<h2 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h2><p>主要是用来批量传输文件的<br><code>ansible 主机/组 -m copy -a ‘参数’</code></p>
<ul>
<li><strong>src</strong> 写本地目录</li>
<li><strong>dest</strong> 客户端目录</li>
</ul>
<p>其他请使用<code>ansible-doc copy</code>查看</p>
<h2 id="service模块"><a href="#service模块" class="headerlink" title="service模块"></a>service模块</h2><p>主要是用来管理服务用的<br><code>ansible 主机/组 -m service -a ‘参数’</code></p>
<ul>
<li><strong>name</strong> 包名</li>
<li><strong>state</strong> 设置状态(started开启 stopped关闭 restarted重启 reloaded重置)</li>
<li><strong>enabled</strong> 参数只有yes和no yes为开机自启 no就是开机不开启</li>
</ul>
<p>其他请使用<code>ansible-doc service</code>查看</p>
<h2 id="set-up模块"><a href="#set-up模块" class="headerlink" title="set-up模块"></a>set-up模块</h2><p>主要是用来显示对应主机的facts变量的，写roles文件用的比较多<br><code>ansible 主机/组 -m setup -a ‘参数’</code><br>用来显示对应主机的facts变量<br>使用参数 <code>filter=’*关键词*</code> 可以进行显示检索<br>具体请使用<code>ansible-doc setup</code>来查看</p>
<h2 id="firewalld模块"><a href="#firewalld模块" class="headerlink" title="firewalld模块"></a>firewalld模块</h2><p>用来管理firewalld防护墙<br><code>ansible 主机/组 -m firewalld -a ‘参数’</code><br><strong>参数：</strong></p>
<ul>
<li><strong>Service</strong> 设置服务名称</li>
<li><strong>Permanent</strong> 是否永久更改(yes,no)</li>
<li><strong>State</strong> 是否放行(enabled,disabled)</li>
<li><strong>Zone</strong> 选择区域</li>
<li><strong>Port</strong> 设置端口(<em>&#x2F;tcp,</em>&#x2F;udp)</li>
</ul>
<p>其他具体请使用<code>ansible-doc firewalld</code>来查看</p>
<h2 id="template模块"><a href="#template模块" class="headerlink" title="template模块"></a>template模块</h2><p>主要是用来复制jnja2文件的，jnja2文件后面会讲<br><code>ansible 主机/组 –m template -a ‘参数’</code></p>
<ul>
<li><strong>src</strong> 文件目录</li>
<li><strong>dest</strong> 复制后的文件目录</li>
</ul>
<p>其他参数请使用<code>ansible-doc template</code>查看</p>
<h2 id="debug模块"><a href="#debug模块" class="headerlink" title="debug模块"></a>debug模块</h2><p>主要是用来debug的输出信息<br><code>ansible 主机/组 -m debug -a ‘参数’</code></p>
<ul>
<li><strong>msg</strong> 输出内容</li>
<li><strong>var</strong> 输出变量</li>
</ul>
<p>其他请使用<code>ansible-doc debug</code>查看</p>
<h1 id="Playbook剧本"><a href="#Playbook剧本" class="headerlink" title="Playbook剧本"></a>Playbook剧本</h1><p>Playbook剧本 类似和脚本一样 用来批量执行模块</p>
<h2 id="使用palybook"><a href="#使用palybook" class="headerlink" title="使用palybook"></a>使用palybook</h2><p>Playbook有着严格的缩进写法,语法非常严谨,使用yml文件来写</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@host</span> <span class="string">test</span>]<span class="comment"># cat creatuser.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>

<p>开头必须使用<code>---</code><br>一个<code>-</code>代表一个任务的开头<br>如果一个块需要配置子参数则就需要严格缩进<br><code>name</code>是描述<br><code>Hosts</code>是主机清单<br><code>Tasks</code>是配置任务<br>子任务中<code>name</code>是描述<br><code>User</code>则就代表user模块<br>模块的子参数就不需要<code>-</code>了<br><code>name</code>则是user的配置参数<br>运行playbook的命令是<code>ansible-playbook palybook文件</code><br><img src="https://image.boychai.xyz/article/ansible_playbook_1.png" alt="playbook1"><br>这是执行除此之外还可以使用命令<code>&quot;ansible-playbook  --syntax-check 文件&quot;</code>来检查文件语法是否有误<br>还有命令<code>&quot;ansible-playbook -C 文件&quot;</code>来运行测试，他会使用文件进行运行测试但不会在目的主机上发生实际改变</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>变量的名称必须以字母开头,并且只能含有字母,数字和下划线.<br>通过<code>vars</code>声明变量通过<code>&quot;&#123;&#123;变量名&#125;&#125;&quot;</code>进行调用<br><img src="https://image.boychai.xyz/article/ansible_playbook_2.png" alt="playbook2"><br>左边的就是使用变量写的,右边就是没用.实质效果一样<br>也可以通过指定一个变量文件来实现 参数:<code>vars_files:文件名</code><br><img src="https://image.boychai.xyz/article/ansible_playbook_3.png" alt="playbook3"><br>我这边定义的是相对目录下的<code>vars.yml</code> 然后图的右边就是<code>vars.yml</code>文件的内容</p>
<h2 id="魔法变量"><a href="#魔法变量" class="headerlink" title="魔法变量"></a>魔法变量</h2><p>魔法变量是ansible的内置变量,直接被定义好的,可以直接拿来使用.<br>常见的魔法变量:</p>
<ul>
<li><strong>hostvars</strong> 列出所有受管理的主机信息.啊如果没有收集facts信息则不会显示facts信息</li>
<li><strong>group_names</strong> 列出当前受管理主机所属的所有组</li>
<li><strong>groups</strong> 列出清单中所有组的字典&#x2F;映射</li>
<li><strong>inventory_hostname</strong> 列出清单中所有配置的当前主机名称</li>
</ul>
<p>其他的可以使用<code>setup</code>模块进行查看</p>
<h2 id="Facts变量"><a href="#Facts变量" class="headerlink" title="Facts变量"></a>Facts变量</h2><p>Facts变量用于采集客户端的信息,比如网络信息,主机名,硬件信息等.<br>每次执行playbook时会对客户端主机进行数据采集<br>实际上它是通过<code>setup</code>模块进行收集数据<br><code>Ansible 主机/组 -m setup</code>可以列出所有的facts变量</p>
<h2 id="When判断"><a href="#When判断" class="headerlink" title="When判断"></a>When判断</h2><p>When就是判断 他只会判断某一条是否为<code>true</code> 否则跳过 可以理解为判断一个布尔类型<br>When虽然不是一个模块但是他的缩进必须和模块对其 卸载<code>tasks</code>后面</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.104</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">run:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">user</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">run</span></span><br></pre></td></tr></table></figure>

<p>这是单条的判断 <code>when</code>会判断上面的值是否为<code>true</code> 是则执行不是则跳过</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.104</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">user</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">presend</span></span><br><span class="line">    <span class="attr">when:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ansible_distribution</span> <span class="string">==</span> <span class="string">&quot;CentOS&quot;</span> <span class="string">and</span> <span class="string">ansible_machine</span> <span class="string">==</span> <span class="string">&quot;x86_64&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ansible_distribution</span> <span class="string">==</span> <span class="string">&quot;CentOS&quot;</span> <span class="string">and</span> <span class="string">ansible_machine</span> <span class="string">==</span> <span class="string">&quot;RedHat&quot;</span></span><br></pre></td></tr></table></figure>

<p>里面的两个值都是<code>facts</code>的变量,只有满足CentOS系统内核为x86和redhat的系统才会执行,否则跳过<br>只有满足CentOS系统内核为x86和redhat的系统才会执行 否则跳过<br><strong>常用判断语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">==        等于</span><br><span class="line">&lt;         小于</span><br><span class="line">&gt;         大于</span><br><span class="line">&lt;=        小于等于</span><br><span class="line">&gt;=        大于等于</span><br><span class="line">!=        不等于</span><br><span class="line">is defined        变量是否定义,定义为true 未定义为false</span><br><span class="line">is not defined    变量是否定义,未定义为false</span><br></pre></td></tr></table></figure>

<p><strong>魔法变量判断</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">when:</span> <span class="string">inventory_hostname</span> <span class="string">in</span> <span class="string">groups[&quot;VMhost&quot;]</span></span><br></pre></td></tr></table></figure>

<p>只有VMhost组中主机才会执行此操作</p>
<h2 id="Loop循环"><a href="#Loop循环" class="headerlink" title="Loop循环"></a>Loop循环</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.104</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">user</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;item.name&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">uid:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;item.uid&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">presend</span></span><br><span class="line">    <span class="attr">loop:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">admin1</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">3001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">admin2</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">3002</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">admin3</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">3003</span></span><br></pre></td></tr></table></figure>

<p><code>Item</code>是循环变量 只要用<code>loop</code>循环执行变量就必须使用<code>item</code> 点的后面使用<code>loop</code>定义的内容 循环的开始都要用 <code>–</code> 表示</p>
<h2 id="Block块"><a href="#Block块" class="headerlink" title="Block块"></a>Block块</h2><p>Ansble的playbook可以把多个和任务组成一个块,然后根据不同条件来执行这个块<br>还能执行失败时执行其他命令<br><strong>Block</strong> 定义块 写的时候要求和任务(<code>tasks</code>)的<code>name</code>对齐<br><strong>Rescue</strong> 当上面的块执行失败时,该关键字下麦呢的任务将被执行<br><strong>Always</strong> 不管<code>block</code>是否执行成功之后都会执行这个任务</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cat</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.104</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cat</span> <span class="string">a.txt</span></span><br><span class="line">      <span class="attr">block:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;查看文件&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">cat</span> <span class="string">/1.txt</span></span><br><span class="line">      <span class="attr">rescue:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;我giao,查看失败,创建文件&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">echo</span> <span class="string">hello,world</span> <span class="string">&gt;</span> <span class="string">/1.txt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;查看文件&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">cat</span> <span class="string">/1.txt</span></span><br><span class="line">      <span class="attr">always:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;执行完成&quot;</span></span><br></pre></td></tr></table></figure>

<p>如下执行结果<br><img src="https://image.boychai.xyz/article/ansible_playbook_4.png" alt="playbokk4"></p>
<h2 id="register命令返回"><a href="#register命令返回" class="headerlink" title="register命令返回"></a>register命令返回</h2><p>以上一个<code>block</code>为例子,给他改一些东西</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cat</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.104</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cat</span> <span class="string">a.txt</span></span><br><span class="line">      <span class="attr">block:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;查看文件&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">cat</span> <span class="string">/1.txt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">var:</span> <span class="string">cattxt</span></span><br><span class="line">          <span class="attr">register:</span> <span class="string">cattxt</span></span><br><span class="line">      <span class="attr">rescue:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;我giao,查看失败,创建文件&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">echo</span> <span class="string">hello,world</span> <span class="string">&gt;</span> <span class="string">/1.txt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;查看文件&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">cat</span> <span class="string">/1.txt</span></span><br><span class="line">      <span class="attr">always:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">&quot;执行完成&quot;</span></span><br></pre></td></tr></table></figure>

<p>执行结果如下<br><img src="https://image.boychai.xyz/article/ansible_playbook_5.png" alt="playbook5"></p>
<h1 id="Roles角色"><a href="#Roles角色" class="headerlink" title="Roles角色"></a>Roles角色</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Ansible <code>roles</code>提供了便捷的方式让你能够轻松的重复利用ansible代码 可以在标准化的目录结构中大伯所有 任务 变量 文件 模板以及完成任务所需要的资源,这样我们只需要将<code>roles</code>从一个项目复制到另一个项目即可在<code>play</code>中直接调用并执行他<br><img src="https://image.boychai.xyz/article/ansible_roles_1.png" alt="Roles目录结构"><br>从第二排开始就是<code>roles</code>的文件 文件中包含很多项目就是第三排的内容 然后第四行就是每个项目中的子目录 这几个子目录都有自己的作用</p>
<h2 id="Roles子目录"><a href="#Roles子目录" class="headerlink" title="Roles子目录"></a>Roles子目录</h2><p><strong>Default</strong>: 此目录中<code>main.yml</code>文件定义新角色变量的默认值,该目录中定义的优先级较低,使用角色时可以覆盖这些变量<br><strong>Files</strong>: 存放角色任务中引用的静态文件<br><strong>Handlers</strong>: 此目录中<code>main.yml</code> 文件定义处理程序<br><strong>Meta</strong>: 此目录中<code>main.yml</code> 文件定义角色相关信息 如:作者,平台,依赖等等<br><strong>Tasks</strong>: 此目录中<code>main.yml</code> 文件定义角色中的任务<br><strong>Templates</strong>: 存放<code>jinja2</code>的模板文件<br><strong>Tests</strong>: 此目录中可以包含清单和<code>test.yml</code>(playbook)用于测试角色<br><strong>Vars</strong>: 此目录中<code>main.yml</code>文件定义角色使用的变量值,优先级高于<code>default</code>目录  </p>
<h2 id="Galaxy"><a href="#Galaxy" class="headerlink" title="Galaxy"></a>Galaxy</h2><p><code>Galax</code>是ansible的一个功能库 你可以使用其他人创建好的<code>roles</code>也可以分享自己的<code>roles</code>.<br>就像<code>docker</code>镜像库一样 需要什么功能就可以直接去下载使用<br>官方网站：<a target="_blank" rel="noopener" href="https://galaxy.ansible.com/">https://galaxy.ansible.com</a><br><code>Ansible-galaxy install 包名</code><br>默认安装会的话会自动安装到<code>~/.ansible/roles/</code>下 可以使用<code>-p</code>参数指定位置<br>然后参数<code>init</code>可以自动生成<code>roles</code>目录<br><code>Ansible-galaxy init 文件夹名字</code><br>参数 <code>-r</code> 可以执行<code>yml</code>下载文件<br>例如</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">src:</span> <span class="string">roles文件地</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">下载后的本地昵称</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">src:</span> <span class="string">roles文件地址</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">下载后的本地昵称</span></span><br></pre></td></tr></table></figure>

<p>安装的时候可以使用命令<br><code>Ansible-galaxy install -r yml.yml</code> 进行下载<br>装好的角色可以使用<code>ansible-galaxy list</code>查看</p>
<h2 id="J2"><a href="#J2" class="headerlink" title="J2"></a>J2</h2><h3 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h3><p>J2全名为<code>jinja2</code>是python下一个被广泛运用的模板引擎,他的设计思想来源于Django的模板引擎,并拓展了其他语法和一系列强大的功能,<code>ansible</code>使用<code>jinja2</code>模板来启用动态表达式和访问变量。</p>
<h3 id="构成"><a href="#构成" class="headerlink" title="构成"></a>构成</h3><p>Jinja2模板的构成：数据 变量 表达式<br>在使用<code>jinja2</code>模板时变量和表达式会被替代成对应的值,变量的值可以在<code>plasybook</code>中定义也可以直接调用<code>facts</code>事实,当然调用<code>facts</code>需要你编写的<code>playbook</code>开启了<code>facts</code>收集 </p>
<h3 id="写法"><a href="#写法" class="headerlink" title="写法"></a>写法</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="code">`&#123;&#123;EXPR&#125;&#125;`</span> 用于装载表达式,比如变量,运算表达式,比较表达式</span><br><span class="line"><span class="bullet">-</span> <span class="code">`&#123;%EXPR%&#125;`</span> 用于装载控制语句 比如<span class="code">`if`</span>,<span class="code">`for`</span>等</span><br><span class="line"><span class="bullet">-</span> <span class="code">`&#123;# #&#125;`</span> 用于注释</span><br></pre></td></tr></table></figure>

<p>Ps:<code>jinja2</code>模板文件本身不需要指定文件扩展名,使用<code>.j2</code>为后缀名只是为了更方便我们管理<code>jinja2</code>的模板</p>
<h2 id="创建和使用角色"><a href="#创建和使用角色" class="headerlink" title="创建和使用角色"></a>创建和使用角色</h2><p>使用命令<code>&quot;ansible-galaxy init galaxy&quot;</code>创建一个<code>galaxy</code>模板</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Ansible roles]# ansible-galaxy init galaxy</span><br><span class="line">- Role galaxy was created successfully</span><br><span class="line">[root@Ansible roles]# <span class="built_in">ls</span></span><br><span class="line">galaxy</span><br><span class="line">[root@Ansible roles]# <span class="built_in">cd</span> galaxy/</span><br><span class="line">[root@Ansible galaxy]# <span class="built_in">ls</span></span><br><span class="line">defaults  files  handlers  meta  README.md  tasks  templates  tests  vars</span><br></pre></td></tr></table></figure>

<p>编辑<code>tasks</code>的<code>main.yml</code>文件写入以下内容</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for galaxy</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">apache</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">httpd</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;item&#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">httpd</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">firewalld</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">set</span> <span class="string">firewalld</span></span><br><span class="line">  <span class="attr">firewalld:</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">permanent:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">enabled</span></span><br><span class="line">    <span class="attr">immediate:</span> <span class="literal">yes</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">set</span> <span class="string">index</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">index.html.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/var/www/html/index.html</span></span><br></pre></td></tr></table></figure>

<p><code>tasks/main.yml</code>文件只需要定义命令,不需要定义主机<br>上面这个<code>main</code>文件是使用<code>yum</code>下载了一个<code>httpd</code>之后使用<code>service</code>开启了防火墙和<code>httpd</code>的服务，又实用防火墙模块放行了对应的服务，之后把<code>j2</code>文件复制到了对应的网站目录页面。<br>之后写一个<code>j2</code>文件放到<code>templates</code>目录里，内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Ansible galaxy]# <span class="built_in">cat</span> templates/index.html.j2</span><br><span class="line">Welcome to &#123;&#123;ansible_default_ipv4.address&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>ansible_default_ipv4.address</code>是<code>facts</code>变量中对应主机的ip<br>写好之后我们来写一个<code>playbook</code>来运行写的<code>roles</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">roles</span> <span class="string">galaxy</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.104</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/root/ansible/roles/galaxy</span></span><br></pre></td></tr></table></figure>

<p>运行结果如下，通过<code>http</code>访问返回内容<br><img src="https://image.boychai.xyz/article/ansible_roles_2.png" alt="运行结果"></p>
<h1 id="Vault加密"><a href="#Vault加密" class="headerlink" title="Vault加密"></a>Vault加密</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>使用<code>ansible</code>的时候难免会有一些比较敏感的数据，比如密码，<code>key</code>等信息直接明文暴露显然不是很好，<code>vault</code>管理加密&#x2F;解密<code>yml</code>(<code>palybook</code>)文件工具，有时编写的<code>playbook</code>文件中会存在重要敏感信息,考虑到安全,可以使用此工具进行加密!</p>
<h2 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h2><p><code>Ansible-vault [参数] [文件]</code></p>
<ul>
<li><strong>Create</strong>: 创建</li>
<li><strong>Decrypt</strong>: 解密</li>
<li><strong>Edit</strong>: 编辑加密文件</li>
<li><strong>Encrypt</strong>: 加密</li>
<li><strong>rekey</strong>: 修改口令</li>
<li><strong>view</strong>: 查看</li>
</ul>
<p>加密之后执行<code>playbook</code>的时候需要附加<code>–ask-vault-pass</code>参数</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>创建用户，用户信息使用<code>vault</code>进行加密，使其不能以明文的形式查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@Ansible ansible]# <span class="built_in">cat</span> vault.yml</span><br><span class="line">---</span><br><span class="line">- name: vault</span><br><span class="line">  vars_file: ./userinfo.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: create user</span><br><span class="line">      user:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123;name&#125;&#125;&quot;</span></span><br><span class="line">        password: <span class="string">&quot;&#123;&#123;password&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">[root@Ansible ansible]# <span class="built_in">cat</span> userinfo.yml</span><br><span class="line">---</span><br><span class="line">- name: <span class="string">&quot;admin&quot;</span></span><br><span class="line">  password: <span class="string">&quot;abc123&quot;</span></span><br><span class="line">[root@Ansible ansible]# ansible-vault encrypt userinfo.yml</span><br><span class="line">New Vault password:</span><br><span class="line">Confirm New Vault password:</span><br><span class="line">Encryption successful</span><br><span class="line">[root@Ansible ansible]# <span class="built_in">cat</span> userinfo.yml</span><br><span class="line"><span class="variable">$ANSIBLE_VAULT</span>;1.1;AES256</span><br><span class="line">63356239383039396263323732396663333132616561323362636662383265626233643465376365</span><br><span class="line">3838633930316666373234633533643065643238653239380a313530633763366262643135363336</span><br><span class="line">62386533313439393761353966316534323464326533306564363565623737393766316231383035</span><br><span class="line">636 NXT1366533837320a316465306139373564623930303330623261343466366336653537333266</span><br><span class="line">61386330336363366633633632303465613535303766653663363734663138393064646237363063</span><br><span class="line">3431616565353131633931326531383262353234366131306130</span><br></pre></td></tr></table></figure>

<p>执行需要使用参数 <code>&quot;–ask-vault-pass&quot;</code> 执行<br><img src="https://image.boychai.xyz/article/ansible_vault_1.png" alt="vault"></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="hosts主机文件写法"><a href="#hosts主机文件写法" class="headerlink" title="hosts主机文件写法"></a>hosts主机文件写法</h2><p><strong>一般写法:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[组名]</span><br><span class="line">IP</span><br><span class="line">域名</span><br><span class="line">······</span><br></pre></td></tr></table></figure>

<p><strong>连续主机写法:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[组名]</span><br><span class="line">1[a-f].example.com</span><br><span class="line">······</span><br></pre></td></tr></table></figure>

<p><strong>父组写法:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[组名:children]</span><br><span class="line">组名</span><br><span class="line">组名</span><br><span class="line">······</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7/" rel="tag"># 开源工具</a>
              <a href="/tags/Ansible/" rel="tag"># Ansible</a>
              <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag"># 自动化</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/21/BIND9-DNS%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="prev" title="BIND9-DNS服务器配置">
                  <i class="fa fa-angle-left"></i> BIND9-DNS服务器配置
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/04/06/Docker-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/" rel="next" title="Docker-容器管理">
                  Docker-容器管理 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">BoyChai</span>
    <a href="/atom.xml" target="_blank">RSS</a>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">158k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:36</span>
  </span>
</div>
<div class="busuanzi-count">
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动 
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"waline-server-ten-phi.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":false,"pageview":false,"avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"requiredMeta":["nick","mail"],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2022/03/05/Ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

</body>
</html>
